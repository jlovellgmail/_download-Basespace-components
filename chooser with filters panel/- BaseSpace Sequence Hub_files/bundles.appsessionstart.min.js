var ilmn=window.ilmn={};if(ilmn.api={},"undefined"==typeof console){var console={};console.log=function(){}}var Ilmn=Ilmn||{};Ilmn.Settings=Ilmn.Settings||{},Ilmn.Mixins=Ilmn.Mixins||{},Ilmn.Models=Ilmn.Models||{},Ilmn.Collections=Ilmn.Collections||{},Ilmn.Views=Ilmn.Views||{},Ilmn.Routers=Ilmn.Routers||{},Ilmn.Apps=Ilmn.Apps||{},Ilmn.Templates=Ilmn.Templates||{};
Ilmn.Utils={},Ilmn.Utils.AddIds=function(items){for(var i=0;i<items.length;i++)_.extend(items[i],{"item-num":i+1});return items},Ilmn.Utils.SetHtmlId=function(model){model.set(model.get("item-num")?{htmlId:model.get("item-num")}:{htmlId:model.cid})},Ilmn.Utils.SavStringFormat=function(statsStruct,decPlaces){decPlaces=decPlaces||0;var mean=statsStruct.Mean||0,dev=statsStruct.Dev||0;return mean.toFixed(decPlaces)+" +/- "+dev.toFixed(decPlaces)},Ilmn.Utils.GetSavCycleErrorRate=function(statsStruct,decPlaces){decPlaces=decPlaces||0;var cyclesstr=statsStruct.MinCycleError+" - "+statsStruct.MaxCycleError;return statsStruct.MinCycleError==statsStruct.MaxCycleError&&(cyclesstr=statsStruct.MinCycleError.toFixed(decPlaces)),cyclesstr},Ilmn.Utils.ParseCSVLine=function(line){line=line.split(",");for(var i=0;i<line.length;i++){var chunk=line[i].replace(/^[\s]*|[\s]*$/g,""),quote="";if(('"'==chunk.charAt(0)||"'"==chunk.charAt(0))&&(quote=chunk.charAt(0)),""!=quote&&chunk.charAt(chunk.length-1)==quote&&(quote=""),""!=quote){var j=i+1;for(j<line.length&&(chunk=line[j].replace(/^[\s]*|[\s]*$/g,""));j<line.length&&chunk.charAt(chunk.length-1)!=quote;)line[i]+=","+line[j],line.splice(j,1),chunk=line[j].replace(/[\s]*$/g,"");j<line.length&&(line[i]+=","+line[j],line.splice(j,1))}}for(var i=0;i<line.length;i++)line[i]=line[i].replace(/^[\s]*|[\s]*$/g,""),'"'==line[i].charAt(0)?line[i]=line[i].replace(/^"|"$/g,""):"'"==line[i].charAt(0)&&(line[i]=line[i].replace(/^'|'$/g,""));return line},function($){window.lastWindowHeight=$(window).height(),window.lastWindowWidth=$(window).width(),$(window).resize(function(){($(window).height()!=window.lastWindowHeight||$(window).width()!=window.lastWindowWidth)&&(window.lastWindowHeight=$(window).height(),window.lastWindowWidth=$(window).width(),$(window).trigger("realWindowResize"))})}(window.jQuery),Ilmn.Utils.GetAppSessionStatusLabel=function(jobState){var result="";switch(jobState){case 0:result="Unknown";break;case 1:result="Aborted";break;case 2:result="Running";break;case 3:result="Needs Attention";break;case 4:result="Complete";break;default:result="Unknown"}return result},Ilmn.Utils.FormatNumberWithCommas=function(x){return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},Ilmn.Utils.ToLegalUrl=function(input){return input.replace(/[^\w]+/g,"-")},Ilmn.Utils.HtmlEscape=function(str){return String(str).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},Ilmn.Utils.IsValidEmail=function(str){var filter=/^\s*[\w\-\+_]+(\.[\w\-\+_]+)*\@[\w\-\+_]+\.[\w\-\+_]+(\.[\w\-\+_]+)*\s*$/;return-1!=String(str).search(filter)},Ilmn.Utils.GravatarUrl=function(email,size){return"https://2.gravatar.com/avatar/"+$.md5(email)+"?s="+size+"&amp;d=identicon&amp;r=G"},Ilmn.Utils.Guid=function(){function _p8(s){var p=(Math.random().toString(16)+"000000000").substr(2,8);return s?"-"+p.substr(0,4)+"-"+p.substr(4,4):p}return _p8()+_p8(!0)+_p8(!0)+_p8()};
!function($){$.fn.blurbable=function(customSettings){var settings={html:"",fetch:{ajax:null,then:null},blurbContainer:this.closest(".modal"),showWhileFetching:!0,blurbFetchDelay:1e3,fadeTimeoutDelay:500,fadeTimeoutDuration:1e3,centerBlurb:!1};return $.extend(!0,settings,customSettings),this.each(function(){var $el=$(this),blurbHTML="<div class='blurb' style='display:none'>"+settings.html+"</div>",$blurb=$(blurbHTML);settings.blurbContainer.append($blurb),$el.on("mouseenter",function(){if(hideAllBlurbs(),fadeBackIn(),needToFetch()){$el.data("blurbFetching",!0);var fetchAjaxFn=settings.fetch.ajax,fetchThenFn=settings.fetch.then;if(settings.showWhileFetching&&showBlurb(),settings.blurbFetchDelay){var timeoutId=setTimeout(function(){fetchAjaxFn().done(function(){fetchDone(function(){fetchThenFn($el,$blurb)})})},settings.blurbFetchDelay);$el.data("blurbFetchTimeout",timeoutId)}else fetchAjaxFn().done(function(){fetchDone(function(){fetchThenFn($el,$blurb)})})}else showBlurb();settings.centerBlurb&&centerBlurb()}),$el.on("mouseleave",function(){if(settings.showWhileFetching&&clearTimeout($el.data("blurbFetchTimeout")),null!=settings.fadeTimeoutDelay&&null!=settings.fadeTimeoutDuration){var hideTimeoutId=setTimeout(function(){fadeOut()});$el.data("blurbHideTimeout",hideTimeoutId)}else $blurb.hide()});var centerBlurb=function(){var elCenterPoint=$el.position().top+$el.outerHeight()/2,halfBlurbHeight=$blurb.outerHeight()/2,topPos=elCenterPoint-halfBlurbHeight;$blurb.css("top",topPos+"px")},fadeBackIn=function(){clearTimeout($el.data("blurbHideTimeout")),$blurb.stop().css("opacity",100)},fadeOut=function(){$blurb.stop().delay(settings.fadeTimeoutDelay).animate({opacity:0},{duration:settings.fadeTimeoutDuration,complete:function(){$blurb.hide()}})};$blurb.on("mouseenter",fadeBackIn).on("mouseleave",fadeOut);var fetchDone=function(extraFn){$el.data("blurbLoaded",!0),settings.showWhileFetching||showBlurb(),extraFn()},hideAllBlurbs=function(){settings.blurbContainer.find(".blurb").hide()},showBlurb=function(){$blurb.stop().show().css({opacity:100})},needToFetch=function(){return null==settings.fetch||null==settings.fetch.ajax?!1:1==$el.data("blurbLoaded")||1==$el.data("blurbFetching")?!1:!0}})}}(jQuery);
var bs;!function(bs){bs.xhrCache=bs.xhrCache||{};var Api=function(){function Api(customOptions){this.fetchIsisAnalysisLowPercentageChart=function(analysisId,successCallback,failCallback,queryParameters){this.apiRequest("GET","isis-analysis/"+analysisId+"/low-percentage/data",queryParameters,successCallback,failCallback)},this.fetchIsisAnalysisMismatchChart=function(analysisId,successCallback,failCallback,queryParameters){this.apiRequest("GET","isis-analysis/"+analysisId+"/mismatch/data",queryParameters,successCallback,failCallback)},this.fetchIsisAnalysisHighPercentageChart=function(analysisId,successCallback,failCallback,queryParameters){this.apiRequest("GET","isis-analysis/"+analysisId+"/high-percentage/data",queryParameters,successCallback,failCallback)},this.fetchIsisAnalysisClustersChart=function(analysisId,successCallback,failCallback,queryParameters){this.apiRequest("GET","isis-analysis/"+analysisId+"/clusters/data",queryParameters,successCallback,failCallback)},this.fetchIsisAnalysisTrimmedLengthChart=function(analysisId,successCallback,failCallback,queryParameters){this.apiRequest("GET","isis-analysis/"+analysisId+"/trimmed-length/data",queryParameters,successCallback,failCallback)},this.checkCors(),this.options={baseUri:"https://api.basespace.illumina.com/v1pre3/",accessToken:null,baseUriProxyFallback:"https://api.basespace.illumina.com/api/proxy/",useXhrCache:!1,cacheTimeout:Api.DEFAULT_CACHE_TIMEOUT},customOptions&&$.extend(!0,this.options,customOptions),this.authType=this.options.accessToken?Api.ACCESS_TOKEN:Api.COOKIE_CREDENTIALS}return Api.prototype.checkCors=function(){var xhr=new XMLHttpRequest;$.support.cors="withCredentials"in xhr,xhr=null,$.support.cors||console.log("CORS isn't supported.")},Api.prototype.getBaseUri=function(){return this.options.baseUri},Api.prototype.setBaseUri=function(s){this.options.baseUri=s},Api.prototype.fetchApplication=function(appId,successCallback,failCallback,queryParameters){this.apiRequest("GET","applications/"+appId,queryParameters,successCallback,failCallback)},Api.prototype.fetchAppSessions=function(successCallback,failCallback,queryParameters){this.apiRequest("GET","users/current/appsessions",queryParameters,successCallback,failCallback)},Api.prototype.fetchAppSessionsByProject=function(projectId,successCallback,failCallback,queryParameters){queryParameters=$.extend(!0,{"output.projects":projectId},queryParameters),this.apiRequest("GET","users/current/appsessions",queryParameters,successCallback,failCallback)},Api.prototype.fetchAppSession=function(appSessionId,successCallback,failCallback,queryParameters){this.apiRequest("GET","appsessions/"+appSessionId,queryParameters,successCallback,failCallback)},Api.prototype.fetchCurrentUser=function(successCallback,failCallback,queryParameters){this.apiRequest("GET","users/current",queryParameters,successCallback,failCallback)},Api.prototype.fetchProjects=function(successCallback,failCallback,queryParameters){this.apiRequest("GET","users/current/projects",queryParameters,successCallback,failCallback)},Api.prototype.fetchProjectName=function(successCallback,failCallback,queryParameters){this.apiRequest("GET","users/current/projects",queryParameters,successCallback,failCallback)},Api.prototype.fetchProject=function(projectId,successCallback,failCallback){this.apiRequest("GET","projects/"+projectId,null,successCallback,failCallback)},Api.prototype.fetchProjectSamples=function(projectId,successCallback,failCallback,queryParameters){this.apiRequest("GET","projects/"+projectId+"/samples",queryParameters,successCallback,failCallback)},Api.prototype.fetchAppSessionsDeep=function(successCallback,failCallback,queryParameters){var _this=this,fetchChildrenListMethod=function(success,fail,queryParams){return _this.fetchAppSessions(success,fail,queryParams)},fetchChildDetailsMethod=this.fetchAppSession;return this.apiRequestDeep(fetchChildrenListMethod,fetchChildDetailsMethod,successCallback,failCallback,queryParameters)},Api.prototype.fetchProjectSamplesDeep=function(projectId,successCallback,failCallback,queryParameters){var _this=this,fetchChildrenListMethod=function(success,fail,queryParams){return _this.fetchProjectSamples(projectId,success,fail,queryParams)},fetchChildDetailsMethod=this.fetchSample;return this.apiRequestDeep(fetchChildrenListMethod,fetchChildDetailsMethod,successCallback,failCallback,queryParameters)},Api.prototype.fetchProjectAppResultsDeep=function(projectId,successCallback,failCallback,queryParameters){var _this=this,fetchChildrenListMethod=function(success,fail,queryParams){return _this.fetchProjectAppResults(projectId,success,fail,queryParams)},fetchChildDetailsMethod=this.fetchAppResult;return this.apiRequestDeep(fetchChildrenListMethod,fetchChildDetailsMethod,successCallback,failCallback,queryParameters)},Api.prototype.fetchGenomesDeep=function(successCallback,failCallback,queryParameters){return this.apiRequestDeep(this.fetchGenomes,this.fetchGenome,successCallback,failCallback,queryParameters)},Api.prototype.fetchProjectAppResults=function(projectId,successCallback,failCallback,queryParameters){this.apiRequest("GET","projects/"+projectId+"/appresults",queryParameters,successCallback,failCallback)},Api.prototype.fetchProjectFiles=function(projectId,successCallback,failCallback,queryParameters){var _this=this;this.apiRequest("GET","projects/"+projectId+"/appresults",{},function(json){var appResults=json.Response.Items,queriedSoFar=0,appResultsToQuery=appResults.length,combinedResponse={Items:[]};1>appResultsToQuery&&successCallback({Response:combinedResponse});for(var i=0;i<appResults.length;i++){var appResult=appResults[i];_this.fetchAppResultFiles(appResult.Id,function(json){for(var appResultFilesResponse=json.Response,currentItems=appResultFilesResponse.Items,j=0;j<currentItems.length;j++){var extraDetailsAboutThisFile={AppResultName:appResult.Name,AppResultId:appResult.Id,AppResultStatus:appResult.Status,UserOwnedBy:appResult.UserOwnedBy};$.extend(currentItems[j],extraDetailsAboutThisFile)}combinedResponse.Items=combinedResponse.Items.concat(currentItems),queriedSoFar++,queriedSoFar==appResultsToQuery&&successCallback({Response:combinedResponse})},failCallback,queryParameters)}},failCallback)},Api.prototype.fetchSample=function(sampleId,successCallback,failCallback){this.apiRequest("GET","samples/"+sampleId,null,successCallback,failCallback)},Api.prototype.fetchSampleFiles=function(sampleId,successCallback,failCallback,queryParameters){this.apiRequest("GET","samples/"+sampleId+"/files",queryParameters,successCallback,failCallback)},Api.prototype.fetchSampleAppResultFiles=function(sampleId,successCallback,failCallback,queryParameters){var _this=this;this.apiRequest("GET","samples/"+sampleId,{},function(json){var response=json.Response,references=response.References,queriedSoFar=0,appResultsToQuery=references.length,combinedResponse={Items:[]};1>appResultsToQuery&&successCallback({Response:combinedResponse});for(var i=0;i<references.length;i++){var reference=references[i];if(reference.Rel==Api.REFERENCE_REL_USED_BY&&reference.Type==Api.REFERENCE_TYPE_APP_RESULT){var appResultId=reference.Content.Id,appResultName=reference.Content.Name,appResultStatus=reference.Content.Status,appResultUserOwnedBy=reference.Content.UserOwnedBy;_this.fetchAppResultFiles(appResultId,function(json){for(var appResultFilesResponse=json.Response,currentItems=appResultFilesResponse.Items,j=0;j<currentItems.length;j++){var extraDetailsAboutThisFile={AppResultName:appResultName,AppResultId:appResultId,AppResultStatus:appResultStatus,UserOwnedBy:appResultUserOwnedBy};$.extend(currentItems[j],extraDetailsAboutThisFile)}combinedResponse.Items=combinedResponse.Items.concat(currentItems),queriedSoFar++,queriedSoFar==appResultsToQuery&&successCallback({Response:combinedResponse})},failCallback,queryParameters)}}},failCallback)},Api.prototype.fetchAppResult=function(appResultId,successCallback,failCallback){this.apiRequest("GET","appresults/"+appResultId,null,successCallback,failCallback)},Api.prototype.fetchAppResultsByAppSession=function(appSessionId,successCallback,failCallback,queryParameters){this.apiRequest("GET","appsessions/"+appSessionId+"/appresults",queryParameters,successCallback,failCallback)},Api.prototype.fetchSampleSource=function(sampleSourceId,successCallback,failCallback,queryParameters){this.apiRequest("GET","sources/"+sampleSourceId,queryParameters,successCallback,failCallback)},Api.prototype.fetchSampleSources=function(successCallback,failCallback,queryParameters){this.apiRequest("GET","users/current/sources",queryParameters,successCallback,failCallback)},Api.prototype.fetchLibraries=function(sampleSourceId,successCallback,failCallback,queryParameters){this.apiRequest("GET","sources/"+sampleSourceId+"/libraries",queryParameters,successCallback,failCallback)},Api.prototype.fetchLibrary=function(sampleLibraryId,successCallback,failCallback,queryParameters){this.apiRequest("GET","libraries/"+sampleLibraryId,queryParameters,successCallback,failCallback)},Api.prototype.fetchAppResultFiles=function(appResultId,successCallback,failCallback,queryParameters){this.apiRequest("GET","appresults/"+appResultId+"/files",queryParameters,successCallback,failCallback)},Api.prototype.fetchGenomes=function(successCallback,failCallback,queryParameters){this.apiRequest("GET","genomes",queryParameters,successCallback,failCallback)},Api.prototype.fetchGenome=function(genomeId,successCallback,failCallback,queryParameters){this.apiRequest("GET","genomes/"+genomeId,null,successCallback,failCallback)},Api.prototype.fetchRuns=function(successCallback,failCallback,queryParameters){this.apiRequest("GET","users/current/runs",queryParameters,successCallback,failCallback)},Api.prototype.fetchRun=function(runId,successCallback,failCallback){this.apiRequest("GET","runs/"+runId,null,successCallback,failCallback)},Api.prototype.fetchFile=function(fileId,successCallback,failCallback,queryParameters){this.apiRequest("GET","files/"+fileId,queryParameters,successCallback,failCallback)},Api.prototype.fetchFileContent=function(fileId,successCallback,failCallback,queryParameters){this.apiRequest("GET","files/"+fileId+"/content",queryParameters,successCallback,failCallback)},Api.prototype.fetchRunCyclePlot=function(runId,successCallback,failCallback,queryParameters){this.apiRequest("GET","runs/"+runId+"/cycleplot/data",queryParameters,successCallback,failCallback)},Api.prototype.fetchRunLanePlot=function(runId,successCallback,failCallback,queryParameters){this.apiRequest("GET","runs/"+runId+"/laneplot/data",queryParameters,successCallback,failCallback)},Api.prototype.fetchRunQScoreHistogram=function(runId,successCallback,failCallback,queryParameters){this.apiRequest("GET","runs/"+runId+"/qscorehistogram/data",queryParameters,successCallback,failCallback)},Api.prototype.fetchRunQScoreHeatmap=function(runId,successCallback,failCallback,queryParameters){this.apiRequest("GET","runs/"+runId+"/qscoreheatmap/data",queryParameters,successCallback,failCallback)},Api.prototype.fetchRunFlowcellChart=function(runId,successCallback,failCallback,queryParameters){this.apiRequest("GET","runs/"+runId+"/flowcellchart/data",queryParameters,successCallback,failCallback)},Api.prototype.fetchRunSampleQCChart=function(runId,successCallback,failCallback,queryParameters){this.apiRequest("GET","runs/"+runId+"/sampleqcchart/data",queryParameters,successCallback,failCallback)},Api.prototype.fetchSpecies=function(successCallback,failCallback,queryParameters){this.apiRequest("GET","species",queryParameters,successCallback,failCallback)},Api.prototype.createProject=function(queryParameters,successCallback,failCallback){var maxNameLength=100;queryParameters.Name.length>maxNameLength&&(queryParameters.Name=queryParameters.Name.substring(0,maxNameLength)),this.apiRequest("POST","projects",queryParameters,successCallback,failCallback)},Api.prototype.search=function(request,queryOverride,successCallBack,failCallback){void 0!=queryOverride&&(request.Query=queryOverride),request.Query||(request.Query="*"),this.apiRequest("GET","search",request,successCallBack,failCallback)},Api.prototype.makePlural=function(entityType){var plural;switch(entityType){case Api.SAMPLELIBRARY:plural="libraries";break;default:plural=entityType+"s"}return plural},Api.prototype.fetchProperties=function(entityType,entityId,queryParameters,successCallback,failCallback){this.apiRequest("GET",this.makePlural(entityType)+"/"+entityId+"/properties",queryParameters,successCallback,failCallback)},Api.prototype.isCachedXhrExpired=function(url){if(bs.xhrCache.hasOwnProperty(url)){var now=new Date,lastFetched=bs.xhrCache[url].lastFetched;if(now-lastFetched<this.options.cacheTimeout)return!1}return!0},Api.prototype.apiRequest=function(method,path,data,successCallback,failCallback){var url,xhr,urlWithQueryParams;if($.support.cors)url=this.options.baseUri+path;else{if($.support.cors||null==this.options.baseUriProxyFallback)return void $.error("CORS not supported, and no fallback provided.");url=this.options.baseUriProxyFallback+path}if(urlWithQueryParams=url+(data?"?"+$.param(data):""),this.options.useXhrCache&&bs.xhrCache.hasOwnProperty(urlWithQueryParams)&&!this.isCachedXhrExpired(urlWithQueryParams))return xhr=bs.xhrCache[urlWithQueryParams].xhr,xhr.then(function(){for(var reasons=[],_i=0;_i<arguments.length-0;_i++)reasons[_i]=arguments[_i+0];var data=reasons[0],textStatus=reasons[1],jqXHR=reasons[2];successCallback(data,textStatus,jqXHR)},function(){for(var reasons=[],_i=0;_i<arguments.length-0;_i++)reasons[_i]=arguments[_i+0];var jqXHR=reasons[0],textStatus=reasons[1],errorThrown=reasons[2];failCallback(jqXHR,textStatus,errorThrown)}),xhr;var ajaxSettings={type:method,url:url,xhrFields:{withCredentials:$.support.cors},crossDomain:$.support.cors,data:data,dataType:"json"};return this.authType==Api.COOKIE_CREDENTIALS&&(xhr=$.ajax(ajaxSettings),xhr.then(function(){for(var reasons=[],_i=0;_i<arguments.length-0;_i++)reasons[_i]=arguments[_i+0];var data=reasons[0],textStatus=reasons[1],jqXHR=reasons[2];successCallback(data,textStatus,jqXHR)},function(){for(var reasons=[],_i=0;_i<arguments.length-0;_i++)reasons[_i]=arguments[_i+0];var jqXHR=reasons[0],textStatus=reasons[1],errorThrown=reasons[2];failCallback(jqXHR,textStatus,errorThrown)}),this.options.useXhrCache&&(bs.xhrCache[urlWithQueryParams]={xhr:xhr,lastFetched:new Date})),xhr},Api.prototype.apiRequestDeep=function(fetchChildrenListMethod,fetchChildDetailsMethod,successCallback,failCallback,queryParameters){var _this=this;fetchChildrenListMethod.call(this,function(json){var response=json.Response,children=response.Items,queriedSoFar=0,numToQuery=children.length,combinedResponse={Items:children,DisplayedCount:response.DisplayedCount,TotalCount:response.TotalCount,Offset:response.Offset,Limit:response.Limit,SortDir:response.SortDir,SortBy:response.SortBy};if(1>numToQuery)return void successCallback(json);for(var i=0;numToQuery>i;i++)fetchChildDetailsMethod.call(_this,children[i].Id,function(json){for(var childDeepResponse=json.Response,childId=childDeepResponse.Id,j=0;j<combinedResponse.Items.length;j++)if(combinedResponse.Items[j].Id==childId){combinedResponse.Items[j]=childDeepResponse,console.log(childDeepResponse);break}queriedSoFar++,queriedSoFar==numToQuery&&successCallback({Response:combinedResponse})},failCallback)},failCallback,queryParameters)},Api.prototype.filterResponseItems=function(items,json){for(var matches=[],i=0;i<items.length;i++){var item=items[i],mergedObj={};$.extend(mergedObj,item,json),mergedObj==item&&matches.push[item]}return matches},Api.PROJECT="project",Api.PROJECTFILE="projectfile",Api.SAMPLE="sample",Api.APPSESSION="appsession",Api.APPRESULT="appresult",Api.SAMPLEFILE="samplefile",Api.FILE="file",Api.SAMPLESOURCE="samplesource",Api.SAMPLELIBRARY="library",Api.GENOME="genome",Api.RUN="run",Api.SPECIES="species",Api.PERMISSIONS_OWNER="owner",Api.PERMISSIONS_COLLABORATOR="collaborator",Api.COOKIE_CREDENTIALS="credentials",Api.ACCESS_TOKEN="access-token",Api.REFERENCE_REL_USED_BY="UsedBy",Api.REFERENCE_TYPE_APP_RESULT="AppResult",Api.DEFAULT_CACHE_TIMEOUT=15e3,Api}();bs.Api=Api;var SearchScopes=function(){function SearchScopes(){}return SearchScopes.fromResourceType=function(resourceType){switch(resourceType.toLowerCase()){case Api.PROJECT:return this.PROJECTS;case Api.APPRESULT:return this.APPRESULTS;case Api.SAMPLE:return this.SAMPLES;case Api.APPSESSION:return this.APPSESSIONS;case Api.RUN:return this.RUNS;case Api.FILE:return this.APPRESULT_FILES}},SearchScopes.ALL="ALL",SearchScopes.RUNS="RUNS",SearchScopes.SAMPLES="SAMPLES",SearchScopes.APPRESULTS="APPRESULTS",SearchScopes.APPS="APPS",SearchScopes.PROJECTS="PROJECTS",SearchScopes.APPSESSIONS="APPSESSIONS",SearchScopes.SAMPLE_FILES="SAMPLE_FILES",SearchScopes.APPRESULT_FILES="APPRESULT_FILES",SearchScopes.USERS="USERS",SearchScopes}();bs.SearchScopes=SearchScopes;var SearchResourceTypes=function(){function SearchResourceTypes(){}return SearchResourceTypes.fromResourceType=function(resourceType){switch(resourceType.toLowerCase()){case Api.PROJECT:return this.PROJECT;case Api.APPRESULT:return this.APPRESULT;case Api.SAMPLE:return this.SAMPLE;case Api.APPSESSION:return this.APPSESSION;case Api.RUN:return this.RUN;case Api.FILE:return this.APPRESULT_FILE}},SearchResourceTypes.RUN="Run",SearchResourceTypes.PROJECT="Project",SearchResourceTypes.APPRESULT="AppResult",SearchResourceTypes.SAMPLE_FILE="Sample_File",SearchResourceTypes.APPRESULT_FILE="AppResult_File",SearchResourceTypes.APPSESSION="AppSession",SearchResourceTypes.SAMPLE="Sample",SearchResourceTypes}();bs.SearchResourceTypes=SearchResourceTypes}(bs||(bs={}));var bs;!function(bs){var Util=function(){function Util(){}return Util.escapeHtml=function(str){var entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};return String(str).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})},Util.getSizeInGigabases=function(sample){return(parseInt(sample.Read1)+parseInt(sample.Read2))*parseInt(sample.NumReadsPF)/1e9},Util.bytesToSize=function(bytes,precision){var kilobyte=1024,megabyte=1024*kilobyte,gigabyte=1024*megabyte,terabyte=1024*gigabyte;return bytes>=0&&kilobyte>bytes?bytes+" B":bytes>=kilobyte&&megabyte>bytes?(bytes/kilobyte).toFixed(precision)+" KB":bytes>=megabyte&&gigabyte>bytes?(bytes/megabyte).toFixed(precision)+" MB":bytes>=gigabyte&&terabyte>bytes?(bytes/gigabyte).toFixed(precision)+" GB":bytes>=terabyte?(bytes/terabyte).toFixed(precision)+" TB":bytes+" B"},Util.stringToBytes=function(str){str=str.toLowerCase();var bytes=1,kilobyte=1024,megabyte=1024*kilobyte,gigabyte=1024*megabyte,multiplier=bytes;if(str.length<3)return parseInt(str);var lastTwoChars=str.substring(str.length-2,str.length);"kb"==lastTwoChars?multiplier=kilobyte:"mb"==lastTwoChars?multiplier=megabyte:"gb"==lastTwoChars&&(multiplier=gigabyte);var num=parseFloat(str.replace(lastTwoChars,"").trim());return num*multiplier},Util.getContent=function(ajaxOptions){if($.support.cors)$.ajax(ajaxOptions);else{var xdr=new XDomainRequest;xdr.onerror=ajaxOptions.error,xdr.onload=ajaxOptions.success,xdr.open("get",ajaxOptions.url),xdr.send()}},Util.getFileNameExtension=function(filename){var ext=filename.split(".").pop();return ext?ext.toLowerCase():""},Util.getFileCategoryByExtension=function(ext){return Util.TEXT_FILE_EXTENSIONS.indexOf(ext)>-1?Util.TEXT_FILE:Util.IMAGE_FILE_EXTENSIONS.indexOf(ext)>-1?Util.IMAGE_FILE:Util.PDF_FILE_EXTENSIONS.indexOf(ext)>-1?Util.PDF_FILE:Util.OTHER_FILE},Util.getFriendlyDate=function(unfriendlyDate){var monthNames=[];monthNames["01"]="January",monthNames["02"]="February",monthNames["03"]="March",monthNames["04"]="April",monthNames["05"]="May",monthNames["06"]="June",monthNames["07"]="July",monthNames["08"]="August",monthNames["09"]="September",monthNames[10]="October",monthNames[11]="November",monthNames[12]="December";var yyyymmdd=unfriendlyDate.substr(0,10),yyyy=unfriendlyDate.substr(0,4),mm=unfriendlyDate.substr(5,2),dd=unfriendlyDate.substr(8,2),friendlyMonth=(new Date(yyyymmdd),monthNames[mm]),friendlyDate=friendlyMonth+" "+dd+", "+yyyy;return friendlyDate},Util.getDateConcise=function(unfriendlyUTCDate,toLocal,twitterTimeToday){if("undefined"==typeof toLocal&&(toLocal=!1),"undefined"==typeof twitterTimeToday&&(twitterTimeToday=!0),!unfriendlyUTCDate)return"";if(twitterTimeToday){var now=moment.utc(),diff=now.diff(moment.utc(unfriendlyUTCDate));if(diff>0&&864e5>diff){var duration=moment.duration(diff),time={hour:duration.hours(),minute:duration.minutes(),second:duration.seconds()},timeStr=" ago";return time.hour>0?timeStr=time.hour+" hour"+(time.hour>1?"s":"")+timeStr:time.minute>0?timeStr=time.minute+" minute"+(time.minute>1?"s":"")+timeStr:time.second>0&&(timeStr=time.second+" second"+(time.second>1?"s":"")+timeStr),timeStr}}return toLocal?moment.utc(unfriendlyUTCDate).local().format(Util.FORMAT_FRIENDLY_DATE_CONCISE):moment.utc(unfriendlyUTCDate).format(Util.FORMAT_FRIENDLY_DATE_CONCISE)},Util.getDatetimeVerbose=function(unfriendlyUTCDate,toLocal){return"undefined"==typeof toLocal&&(toLocal=!1),unfriendlyUTCDate?toLocal?moment.utc(unfriendlyUTCDate).local().format(Util.FORMAT_FRIENDLY_DATETIME_VERBOSE):moment.utc(unfriendlyUTCDate).format(Util.FORMAT_FRIENDLY_DATETIME_VERBOSE):""},Util.getHumanizedDuration=function(startDateUnformatted,endDateUnformatted){if(!startDateUnformatted||!endDateUnformatted)return"";var diff=moment(endDateUnformatted).diff(moment(startDateUnformatted));return moment.duration(diff).humanize()},Util.getDuration=function(startDateUnformatted,endDateUnformatted,smallestUnit){if(!startDateUnformatted||!endDateUnformatted)return"";var diff=moment.utc(endDateUnformatted).diff(moment.utc(startDateUnformatted)),duration=moment.duration(diff),time={year:duration.years(),month:duration.months(),day:duration.days(),hour:duration.hours(),minute:duration.minutes(),second:duration.seconds()},durationString="";for(var key in time){var value=time[key];if((value>0||key===smallestUnit)&&(durationString=durationString+value+" "+key+(1!=value?"s":"")+" "),key===smallestUnit)break}return durationString=durationString.trim()},Util.getDateConciseHtml=function(unfriendlyUTCDate,toLocal,twitterTimeToday){return"undefined"==typeof toLocal&&(toLocal=!1),"undefined"==typeof twitterTimeToday&&(twitterTimeToday=!0),'<time datetime="'+unfriendlyUTCDate+'" rel="tooltip" title="'+bs.Util.getDatetimeVerbose(unfriendlyUTCDate,toLocal)+(toLocal?" (Local timezone)":" (UTC)")+'">'+bs.Util.getDateConcise(unfriendlyUTCDate,toLocal,twitterTimeToday)+"</time>"},Util.getDatetimeVerboseHtml=function(unfriendlyUTCDate,toLocal){return"undefined"==typeof toLocal&&(toLocal=!1),'<time datetime="'+unfriendlyUTCDate+'" rel="tooltip" title="'+(toLocal?"Local timezone":"UTC")+'">'+bs.Util.getDatetimeVerbose(unfriendlyUTCDate,toLocal)+"</time>"},Util.bindEventsOnce=function(eventName,selector,fn){console.log("Binding events once.");var eventBoundClass=eventName+"-event-bound";$(document).on(eventName,selector+":not(."+eventBoundClass+")",fn),$(selector).addClass(eventBoundClass)},Util.uniquifySelector=function(selector){if($(selector).length<1)return selector;var i=1;do var newSelector=selector+"-"+i++;while($(newSelector).length>0);return newSelector},Util.formatNumberWithCommas=function(x){return x.toString().indexOf(".")<0?x.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):x.toString()},Util.trimAndAddUnits=function(str){var realStr=str.toString();return this.endsWith(realStr,"000000000")?realStr.replace(new RegExp("000000000$")," G"):this.endsWith(realStr,"000000")?realStr.replace(new RegExp("000000$")," M"):this.endsWith(realStr,"000")?realStr.replace(new RegExp("000$")," K"):realStr},Util.trimAndAddUnitsV2=function(str){var realStr=str.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,").replace(/,\d\d\d/g,",000");return this.endsWith(realStr,",000,000,000")?realStr.replace(new RegExp(",000,000,000$")," G"):this.endsWith(realStr,",000,000")?realStr.replace(new RegExp(",000,000$")," M"):this.endsWith(realStr,",000")?realStr.replace(new RegExp(",000$")," K"):realStr},Util.formatThreeDigitPercision=function(str){var realStr=str.toString();return realStr.indexOf(".")<0?str:parseFloat(realStr).toPrecision(3).replace(/^0./,".")},Util.endsWith=function(str,key){var realStr=str.toString();return-1!==realStr.indexOf(key,realStr.length-key.length)},Util.IMAGE_FILE="image",Util.TEXT_FILE="text",Util.OTHER_FILE="other",Util.PDF_FILE="pdf",Util.FORMAT_FRIENDLY_DATETIME_VERBOSE="dddd, MMMM Do YYYY, h:mm:ss a",Util.FORMAT_FRIENDLY_DATE_CONCISE="MMM DD YYYY",Util.TEXT_FILE_EXTENSIONS=["txt","asc","bed","gff","gff3","fastq","vcf","csv","xml","tab","tsv","html","xml","xhtml","log","json","sql","yaml"],Util.IMAGE_FILE_EXTENSIONS=["jpg","jpeg","gif","png"],Util.PDF_FILE_EXTENSIONS=["pdf"],Util}();bs.Util=Util}(bs||(bs={})),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});
!function($){function isDOMAttrModifiedSupported(){var p=document.createElement("p"),flag=!1;if(p.addEventListener)p.addEventListener("DOMAttrModified",function(){flag=!0},!1);else{if(!p.attachEvent)return!1;p.attachEvent("onDOMAttrModified",function(){flag=!0})}return p.setAttribute("id","target"),flag}function checkAttributes(chkAttr,e){if(chkAttr){var attributes=this.data("attr-old-value");if(e.attributeName.indexOf("style")>=0){attributes.style||(attributes.style={});var keys=e.attributeName.split(".");e.attributeName=keys[0],e.oldValue=attributes.style[keys[1]],e.newValue=keys[1]+":"+this.prop("style")[$.camelCase(keys[1])],attributes.style[keys[1]]=e.newValue}else e.oldValue=attributes[e.attributeName],e.newValue=this.attr(e.attributeName),attributes[e.attributeName]=e.newValue;this.data("attr-old-value",attributes)}}var MutationObserver;try{MutationObserver=MutationObserver||WebKitMutationObserver}catch(e){}$.fn.attrchange=function(o){var cfg={trackValues:!1,callback:$.noop};if("function"==typeof o?cfg.callback=o:$.extend(cfg,o),cfg.trackValues&&$(this).each(function(i,el){for(var attr,attributes={},i=0,attrs=el.attributes,l=attrs.length;l>i;i++)attr=attrs.item(i),attributes[attr.nodeName]=attr.value;$(this).data("attr-old-value",attributes)}),MutationObserver){var mOptions={subtree:!1,attributes:!0,attributeOldValue:cfg.trackValues},observer=new MutationObserver(function(mutations){mutations.forEach(function(e){var _this=e.target;cfg.trackValues&&(e.newValue=$(_this).attr(e.attributeName)),cfg.callback.call(_this,e)})});return this.each(function(){observer.observe(this,mOptions)})}return isDOMAttrModifiedSupported()?this.on("DOMAttrModified",function(event){event.originalEvent&&(event=event.originalEvent),event.attributeName=event.attrName,event.oldValue=event.prevValue,cfg.callback.call(this,event)}):"onpropertychange"in document.body?this.on("propertychange",function(e){e.attributeName=window.event.propertyName,checkAttributes.call($(this),cfg.trackValues,e),cfg.callback.call(this,e)}):this}}(jQuery);
Ilmn.AppSessionStart=function(settings){function initResourceChoosers(chooser){return $.Deferred(function(def){var resChooserSelector=chooser?chooser:"bs-chooser-form-control";$(resChooserSelector).each(function(){$(this).on("confirm",function(e,selectedItemIds){console.log("confirm",arguments),clearValidationMessages();var $el=$(this),controlId=$el.data("bs-input-id"),$parent=$el.parent(),resourceType=$(this).attr("resource-type");$parent.find("input[type=hidden]").filter(function(){var type=$(this).data("type");return type&&"resourceid"==type.toLowerCase()}).remove(),selectedItemIds&&selectedItemIds.length>0&&(console.log("confirm item count: "+selectedItemIds.length),$.each(selectedItemIds,function(index,resourceId){var $input=findResourceInput($parent,controlId,resourceId);if(0==$input.length){var data={controlId:controlId,resourceId:resourceId,resourceType:resourceType};$parent.append(_.template(_settings.selectedResourceTemplate,data)),addPropertyFields(controlId,resourceId,resourceType)}}),setTimeout(function(){processResourceChooserMessages(_errors,_warnings,controlId)},60)),bs.onFormChange()}),$(this).on("deselect",function(e,deselectedItems){for(var i=0;i<deselectedItems.length;i++){var resourceId=deselectedItems[i],controlId=$(this).data("bs-input-id"),$parent=$(this).parent();$(this).data("bsSelectionIds").length<1&&$(this).find(".selected-resource-list thead").hide();var $input=findResourceInput($parent,controlId,resourceId);$input.length>0&&$input.remove()}bs.onFormChange()}),$(document).on("request-new-project",function(){var dialog=new bs.Views.ModalDialogs.EditProject;bs.Controllers.ModalDialogController.showModalDialog(dialog),dialog.on(bs.Events.CREATE_PROJECT_SUCCESS,function(model){$(document).trigger("request-new-project-success",[model.Id,model.Name]),dialog.off(bs.Events.CREATE_PROJECT_SUCCESS)}),dialog.on(bs.Events.DIALOG_CANCEL,function(){$(document).trigger("request-new-project-cancelled")})}),$(this).on("open",function(e,params){params.origin.getBoundElement().siblings(".alert").remove(),0==$(".alert").size()&&$("button[disabled='disabled']").removeAttr("disabled")})}),def.resolve()}).promise()}function findResourceInput($parent,name,value){return $parent.children("input[type=hidden]").filter(function(){var $this=$(this);return $this.prop("name")==name&&$this.val()==value}).first()}function onSubmit(e){var $form=$(this),$button=$form.find("button[data-type=submit]");return $button.prop("disabled",!0),$button.append(_$loadingIcon),_hasValidated?!0:(e.preventDefault(),clearValidationMessages(),clearMatcherValidationMessages(),$("body").append('<div class="bs-loading-overlay-bg"><div class="bs-loading-overlay">Loading <img src="/public/cdn/basespace/libraries/bootstrap/images/loading-icon-mini.gif" /> </div></div>'),void $.ajax({url:"/appsession/validate",type:"POST",data:$form.serialize(),success:function(response){if(console.log("validation result: "),console.log(JSON.stringify(response)),response.HasMessages){console.log("has messages"),_errors=response.Errors,warnedAlready(_warnings,response.Warnings)&&(_warningsDismissed=!0),_warnings=response.Warnings,processValidationMessages(_errors,_warnings);var $alert=$('<div class="form-validation-summary">');if(response.HasErrors){$alert.addClass(_settings.validationErrorCssClass);var msg="";msg=response.HasWarnings?"Please review the validation errors and warnings below":"Please review the validation errors below",$alert.html(msg)}else response.HasWarnings&&!_warningsDismissed&&($alert.addClass(_settings.validationWarningCssClass),$alert.html("Please review the validation warnings below"));$form.prepend($alert);var button=$("#send-to-agent-button-id");$(button).removeClass("disabled"),button=$("#create-appsession-button-id"),$(button).removeClass("disabled"),button=$("#simulate-launch-button-id"),$(button).removeClass("disabled")}else _errors=[],_warnings=[];0!=_errors.length||0!=_warnings.length&&!_warningsDismissed?($button.prop("disabled",!1).removeClass("disabled"),_$loadingIcon.remove(),$(".bs-loading-overlay-bg").remove()):(_hasValidated=!0,$form.submit(),bs.isDeveloperMode&&(_hasValidated=!1,$button.prop("disabled",!1).removeClass("disabled"),_$loadingIcon.remove(),$(".bs-loading-overlay-bg").remove()))},error:function(){$button.prop("disabled",!1),_$loadingIcon.remove()}}))}function getURLParameter(name){return decodeURI((RegExp(name+"=(.+?)(&|$)").exec(location.search)||[,null])[1])}function warnedAlready(lastWarnings,currentWarnings){if(!lastWarnings)return!1;if(lastWarnings.length!=currentWarnings.length)return!1;for(var key in lastWarnings){var lastWarning=lastWarnings[key],currentWarning=currentWarnings[key];if(lastWarning.ControlId!=currentWarning.ControlId||lastWarning.Message!=currentWarning.Message||lastWarning.ResourceId!=currentWarning.ResourceId)return!1}return!0}function clearValidationMessages(){var $form=$(_settings.configFormSelector);$form.find(controlGroupSelector).removeClass(_settings.controlGroupErrorCssClass).removeClass(_settings.controlGroupWarningCssClass),$form.find(".validation-icon-wrapper").remove(),$form.find(".alert-danger, .alert-warning").removeClass(_settings.validationWarningCssClass).removeClass(_settings.validationErrorCssClass),$form.find(".form-validation-summary").remove()}function clearMatcherValidationMessages(){var $form=$(_settings.configFormSelector);angular.element($form).find(resourceMatcherSelector).each(function(){$(this).children().scope().$apply(function(scope){scope.manager.confirmedMatrix.errors.length=0,scope.manager.updateMatrixErrors()})})}function getResourceValidationMessages(messages){return _.filter(messages,function(msg){return msg.ResourceId&&msg.ResourceId.length>0})}function processValidationMessages(errors,warnings){errors=errors||[],warnings=warnings||[];var controlErrors=_.filter(errors,function(error){return!error.ResourceId}),controlWarnings=_.filter(warnings,function(warning){return!warning.ResourceId});processInputControlMessages(controlErrors,controlWarnings);var resourceErrors=getResourceValidationMessages(errors),resourceWarnings=getResourceValidationMessages(warnings);processResourceChooserMessages(resourceErrors,resourceWarnings),processResourceMatcherMessages(errors,warnings)}function concatMessages(errors,warnings){errors=errors&&$.isArray(errors)?errors:[],warnings=warnings&&$.isArray(warnings)?warnings:[];for(var i in errors)errors[i].type="error";for(var i in warnings)warnings[i].type="warning";return errors.concat(warnings)}function mapToResourceMatcherErrors(messages){var errs=[];for(var i in messages)errs.push({ControlId:messages[i].ControlId,type:"error"==messages[i].type?bs.Common.Interfaces.MessageType.ERROR:bs.Common.Interfaces.MessageType.WARNING,code:"VALIDATION_SERVER_ERROR",message:messages[i].Message,data:{item:{id:messages[i].ResourceId},position:{columnId:messages[i].ColumnId?messages[i].ColumnId:null,rowNumber:messages[i].RowNumber?parseInt(messages[i].RowNumber):null}}});return errs}function processInputControlMessages(errors,warnings){var allMessages=concatMessages(errors,warnings),controlGroups=_.groupBy(allMessages,function(message){var $control=findControl(message.ControlId);return $control&&$control.size()>0?$control.data("bs-input-id"):null});for(var id in controlGroups){var controlMessages=controlGroups[id],controlErrors=_.filter(controlMessages,function(error){return"error"==error.type}),controlWarnings=_.filter(controlMessages,function(warning){return"warning"==warning.type}),$control=findControl(id);if(controlErrors.length>0&&$control&&$control.find(validationIconWrapperSelector).length<1){var $icon=$(_settings.validationErrorIcon),$iconWrapper=createValidationIconWrapper();$iconWrapper.append($icon),addValidationIcon($control,$iconWrapper,!0);var $controlGroup=$control.closest(controlGroupSelector);$controlGroup.addClass(_settings.controlGroupErrorCssClass);var validationModel={messages:controlErrors,heading:"Errors:",icon:$icon.clone().html(),type:_blurbType.errors};$icon.blurbable({blurbContainer:$iconWrapper,html:_.template(_settings.validationBlurbTemplate,validationModel),fadeTimeoutDelay:0,fadeTimeoutDuration:0}),$control.add($icon)}if(controlWarnings.length>0){var $icon=$(_settings.validationWarningIcon),$iconWrapper=createValidationIconWrapper();$iconWrapper.append($icon),addValidationIcon($control,$iconWrapper,!0);var $controlGroup=$control.closest(controlGroupSelector);0==controlErrors.length&&$controlGroup.addClass(_settings.controlGroupWarningCssClass);var validationModel={messages:controlWarnings,heading:"Warnings:",icon:$icon.clone().html(),type:_blurbType.warnings};$icon.blurbable({blurbContainer:$iconWrapper,html:_.template(_settings.validationBlurbTemplate,validationModel),fadeTimeoutDelay:0,fadeTimeoutDuration:0}),$control.add($icon)}}}function processResourceChooserMessages(errors,warnings,resourceChooserId){console.log("processing resource chooser messages");var allMessages=concatMessages(errors,warnings),chooserGroups=_.groupBy(allMessages,function(message){var $control=findControl(message.ControlId);return $control&&$control.size()>0?$control.data("bs-input-id"):null});for(var chooserId in chooserGroups)if(chooserId){$chooser=findControl(chooserId);var anyErrors,anyWarnings=!1,chooserMessages=chooserGroups[chooserId],resourceGroups=_.groupBy(chooserMessages,function(message){return message.ResourceId});for(var resourceId in resourceGroups){var resourceMessages=resourceGroups[resourceId],resourceErrors=_.filter(resourceMessages,function(error){return"error"===error.type});resourceErrors.length>0&&(anyErrors=!0);var resourceWarnings=_.filter(resourceMessages,function(warning){return"warning"===warning.type});resourceWarnings.length>0&&(anyWarnings=!0);var resourceSelector="tr[data-bs-resource-id="+resourceId+"]",$resource=$chooser?$chooser.find(resourceSelector):null;if($resource&&$resource.length>0){var cssClass=resourceErrors.length>0?_settings.validationErrorCssClass:_settings.validationWarningCssClass;$resource.addClass(cssClass);var $iconWrapper=createValidationIconWrapper("resource-validation");if(resourceWarnings.length>0){var $icon=$(_settings.validationWarningIcon);$iconWrapper.append($icon);var validationModel={messages:resourceWarnings,heading:"Warnings:",icon:$icon.html(),type:_blurbType.warnings};$icon.blurbable({blurbContainer:$resource.closest(".resource-chooser-container"),html:_.template(_settings.validationBlurbTemplate,validationModel),fadeTimeoutDelay:0,fadeTimeoutDuration:0})}if(resourceErrors.length>0){var $icon=$(_settings.validationErrorIcon);$iconWrapper.append($icon);var validationModel={messages:resourceErrors,heading:"Errors:",icon:$icon.html(),type:_blurbType.errors};$icon.blurbable({blurbContainer:$resource.closest(".resource-chooser-container"),html:_.template(_settings.validationBlurbTemplate,validationModel),fadeTimeoutDelay:0,fadeTimeoutDuration:0})}addValidationIcon($resource,$iconWrapper,!1)}}var $controlGroup=$chooser.closest(controlGroupSelector);anyErrors?$controlGroup.addClass(_settings.controlGroupErrorCssClass):($controlGroup.removeClass(_settings.controlGroupErrorCssClass),anyWarnings?$controlGroup.addClass(_settings.controlGroupWarningCssClass):$controlGroup.removeClass(_settings.controlGroupWarningCssClass))}}function processResourceMatcherMessages(errors,warnings){var allMessages=concatMessages(errors,warnings),resMatcherMessages=mapToResourceMatcherErrors(allMessages),matcherGroups=_.groupBy(resMatcherMessages,function(message){var $control=findControl(message.ControlId),$filtered=$control?$control.filter(resourceMatcherSelector):null;return $filtered&&$filtered.size()>0?$filtered.attr("input-field-id"):null});for(var matcherId in matcherGroups)if(matcherId){var matcher=angular.element(findControl(matcherId));matcher.length>0&&(matcher.children().scope().$apply(function(scope){for(var i=0;i<matcherGroups[matcherId].length;i++)scope.manager.confirmedMatrix.errors.push(matcherGroups[matcherId][i]);scope.manager.updateMatrixErrors()}),matcher.find("bs-tray").scope().$apply(function(scope){scope.isTrayExpanded=!0}))}}function addValidationIcon($control,$icon,appendToParent){appendToParent=appendToParent||!1,appendToParent?$control.closest(controlGroupSelector).append($icon):($icon.addClass("resource-validation-icon"),$control.find(".first-col").append($icon))}function createValidationIconWrapper(cssClass){return cssClass=cssClass||"",$('<span class="'+validationIconWrapperClassName+" "+cssClass+'"></span>')}function toggleFields(fields,enable){for(var i=0;i<fields.length;i++){var field=fields[i].trim(),$toToggle=$(":input[name='"+field+"'],bs-chooser-form-control[id='"+field+"'] button,bs-chooser-form-control[data-bs-input-id='"+field+"'] button,.repeatable-fieldset[id='"+field+"'] :input,.repeatable-fieldset[id='"+field+"'] .action-link,.fieldset[id='"+field+"'] :input,bs-grouper-form-control[input-field-id='"+field+"'] button");console.log("toggling ",$toToggle),console.log("setting disabled to "+!enable),$toToggle.prop("disabled",!enable),$toToggle.data("is-disabled",!enable)}}function handleToggled(toggler,options){var togglerVals=[];$(toggler).filter(":checked").each(function(){togglerVals.push((""+$(this).val()).toLowerCase())}),$(toggler).find("option").filter(":selected").each(function(){togglerVals.push((""+$(this).val()).toLowerCase())}),console.log("toggler values: "+JSON.stringify(togglerVals)+" toggleOnValues:"+JSON.stringify(options.toggleOnValues)),console.log("toggle fields: "+options.dataToggleFields);var enable=!1;0===options.toggleOnValues.length&&0===togglerVals.length?enable=!0:$.each(options.toggleOnValues,function(index,value){return $.inArray(value.trim(),togglerVals)>-1?(enable=!0,!1):void 0}),toggleFields(options.dataToggleFields,enable)}function initToggler(options){var $toggler=$(":input[name='"+options.toggler+"']");handleToggled($toggler,options),$toggler.on("change",function(){console.log("toggler "+$(this).attr("name")+" has changed"),handleToggled($toggler,options)})}function getTogglerOptions(toogler){return{toggler:toogler.data("toggler"),toggleOnValues:0===toogler.data("toggle-on-value").length?[]:(""+toogler.data("toggle-on-value")).toLowerCase().split(","),dataToggleFields:(""+toogler.data("toggle-fields")).toLowerCase().split(",")}}function initTogglers(togglerElement){console.log("init togglers"),$(togglerElement?togglerElement:".toggler").each(function(){var options=getTogglerOptions($(this));initToggler(options)})}function handleAllTogglers(){$(".toggler").each(function(){var options=getTogglerOptions($(this)),$toggler=$(":input[name='"+options.toggler+"']");handleToggled($toggler,options)})}function addPropertyFields(controlId,resourceId,resourceType){var propertyFieldSelector="script[id='"+controlId+"-property-field-template']",selector="bs-chooser-form-control[data-bs-input-id='"+controlId+"'] tr[data-bs-resource-id='"+resourceId+"']";setTimeout(function(){addFields(controlId,resourceId,resourceType,$(selector),propertyFieldSelector)},60)}function addFields(controlId,resourceId,resourceType,item,propertyFieldSelector){var propertyFieldHtml=$(propertyFieldSelector).html();if(!propertyFieldHtml)return!1;$(item).find(".property-field").remove();var $selectedItem=$(item),numItems=$(propertyFieldHtml).find(controlGroupSelector).length,chooserSelector="bs-chooser-form-control[data-bs-input-id='"+controlId+"']",$chooser=$(chooserSelector);numItems>0&&$chooser.find(".selected-resource-list td:first-child").css({width:"35%"}),$(propertyFieldHtml).find(controlGroupSelector).each(function(){var propertyName=$(this).data("bsInputId"),label=$(propertyFieldHtml).find("label[for='"+propertyName+"']").html(),propertyFieldTemplate=$("#property-field-template").html(),propertyFieldHeaderTemplate=$("#property-field-header-template").html();$selectedItem.find("td:last-child").before(_.template(propertyFieldTemplate,{propertyId:propertyName,numProperties:numItems})),numItems>0&&$chooser.find(".selected-resource-list thead").is(":hidden")&&$chooser.find(".selected-resource-list thead").show(),0==$chooser.find(".selected-resource-list thead .header-row td[data-property-id='"+propertyName+"']").length&&$chooser.find(".selected-resource-list thead .header-row td:last-child").before(_.template(propertyFieldHeaderTemplate,{propertyId:propertyName,title:label,numProperties:numItems}));var inputGroup=_.groupBy($(this).find(":input"),function(inputGroupItem){return $(inputGroupItem).attr("id")});for(var input in inputGroup){"appresult"==resourceType&&(resourceType="analysis");var propertyFieldName=[controlId,resourceType,resourceId,propertyName].join("."),$item=$(_properties[propertyFieldName]);if(0==$item.length){var $inputs=$();$(inputGroup[input]).each(function(){$inputs=addInput(this,$inputs,propertyFieldName)}),$item=$inputs,_properties[propertyFieldName]=$item}if($selectedItem.find("td[data-property-id='"+propertyName+"']").append($item),0==$chooser.find(".selected-resource-list thead .select-all-row td[data-property-id='"+propertyName+"']").length&&$chooser.find(".selected-resource-list thead .select-all-row td:last-child").before(_.template(propertyFieldTemplate,{propertyId:propertyName,numProperties:numItems})),$selectedItem.find("td[data-property-id='"+propertyName+"']").find(":input").length>$chooser.find(".selected-resource-list thead .select-all-row td[data-property-id='"+propertyName+"']").find(":input").length){var selectAllFieldName=propertyName+"-select-all",$selectAllFields=$(_properties[selectAllFieldName]);if(0==$selectAllFields.length){var $selectAllInputs=$();$(inputGroup[input]).each(function(){$selectAllInputs=addInput(this,$selectAllInputs,selectAllFieldName)}),$selectAllFields=$selectAllInputs,$(document).on("change",chooserSelector+" :input[name='"+selectAllFieldName+"']",selectAllProperties),_properties[selectAllFieldName]=$selectAllFields}$chooser.find(".selected-resource-list thead .select-all-row td[data-property-id='"+propertyName+"']").append($selectAllFields)}bs.onFormChange()}})}function addInput(source,target,name){var $itemLabel=$(source).next(".item-label").clone(),$input=$(source).clone();$input.attr("name",name);var $target=$(target).add($input).add($itemLabel);return $target}function selectAllProperties(){var fieldId=$(this).attr("id"),fieldName=$(this).attr("name"),$allInputs=$(_properties[fieldName]).filter(":input"),$values="checkbox"==$allInputs.attr("type")||"radio"==$allInputs.attr("type")?$allInputs.filter(":checked"):$allInputs,values=[];$.isArray($allInputs.val())?values=$allInputs.val():$values.each(function(){values.push($(this).val())});var $fields=$(this).closest(".selected-resource-list").find("tbody :input#"+fieldId);$fields.val(values)}function addRepeatableFieldset(fieldset){var maxRows=$(fieldset).data("maxRows"),$fieldsetRepeaterContainer=$(fieldset).find(".fieldset-repeater-container"),fieldsetId=$(fieldset).attr("id"),rowCount=$fieldsetRepeaterContainer.find(".repeatable-fieldset-repeater").size();if(maxRows&&rowCount==maxRows)return void console.warn("maximum rows reached("+maxRows+"). Ignoring request to add more.");var fieldSetTemplate=$("script[id='"+fieldsetId+"-repeater-template']").html(),rowNumber=Ilmn.Utils.Guid(),innerHtml=_.template(fieldSetTemplate,{rownumber:rowNumber});$fieldsetRepeaterContainer.append(innerHtml),resetRepeaterIds(fieldset);var $repeater=$fieldsetRepeaterContainer.find(".repeatable-fieldset-repeater[data-row-number='"+rowNumber+"']"),chooserFormControl=angular.element("[data-row-number="+rowNumber+"] bs-chooser-form-control");if(chooserFormControl.length>0){var $injector=$("[ng-app='bs.Common']").injector();$injector.invoke(["$compile",function($compile){var scope=chooserFormControl.scope();$compile(chooserFormControl)(scope),scope.$digest(),initResourceChoosers(chooserFormControl)}])}var togglers=$repeater.find(".toggler");$(togglers).each(function(i){initTogglers(togglers[i])});var helpTexts=$repeater.find(".info-blurb");$(helpTexts).each(function(i){initHelpText(helpTexts[i])}),toggleFieldsetAdder(fieldset),$repeater.find(".repeater-delete-action").on("click",deleteRepeatableFieldset),$repeater.find(":input").on("change",_this.updateFormAttributes)}function toggleFieldsetAdder(fieldset){var $fieldset=$(fieldset),maxRows=$fieldset.data("maxRows"),rowCount=$fieldset.find(".repeatable-fieldset-repeater").size(),$addMore=$fieldset.find(".repeatable-fieldset-adder");maxRows&&rowCount==maxRows?($addMore.attr("title","Maximum rows "+maxRows+" has been reached.  You cannot add any more."),$addMore.css({"pointer-events":"auto"}),$addMore.prop("disabled",!0)):($addMore.prop("disabled",!1),$addMore.removeAttr("title"))}function initRepeatableFieldsets(){var repeatableFieldsets=$(".repeatable-fieldset");$(".repeatable-fieldset").each(function(i){var fieldset=$(repeatableFieldsets[i]);$(fieldset).find(".repeatable-fieldset-adder").on("click",function(e){if($(this).data("is-disabled"))return console.warn("adder disabled, ignoring request to add"),!1;var fieldset=$(e.currentTarget).closest(".repeatable-fieldset");addRepeatableFieldset(fieldset),e.preventDefault(),e.stopPropagation()}),addRepeatableFieldset(fieldset)})}function deleteRepeatableFieldset(e){$(this).data("is-disabled")&&console.warn("fieldset disabled, ignoring remove request");var $fieldset=$(e.currentTarget).closest(".repeatable-fieldset"),$fieldsetRepeater=$(e.currentTarget).closest(".repeatable-fieldset-repeater");$fieldsetRepeater.find("*").off(),$fieldsetRepeater.find("bs-chooser-form-control").each(function(){var chooserFormControl=angular.element(this),$injector=chooserFormControl.injector();$injector.invoke([function(){var $scope=chooserFormControl.children().first().scope();$scope&&$scope.$destroy(),chooserFormControl.remove()}])}),console.debug("deleting fieldset",$fieldsetRepeater),$fieldsetRepeater.remove(),toggleFieldsetAdder($fieldset),resetRepeaterIds($fieldset)}function resetRepeaterIds(fieldset){var $repeaters=$(fieldset).find(".repeatable-fieldset-repeater"),numRepeaters=$repeaters.size();$repeaters.each(function(index){var rowNum=index+1,$repeater=$(this);$repeater.find(".repeatable-fieldset-repeater-number").text("# "+rowNum),$repeater.find("[data-bs-input-id]").each(function(){var $control=$(this);$control.attr("data-bs-input-id",replaceRowId($control.attr("data-bs-input-id"),rowNum)),$control.data("bs-input-id",$control.attr("data-bs-input-id"))}),$repeater.find(":input[name]").each(function(){var $input=$(this);$input.attr("name",replaceRowId($input.attr("name"),rowNum)),$input.attr("id",replaceRowId($input.attr("id"),rowNum))}),$repeater.find("script[id]").each(function(){var $script=$(this);$script.attr("id",$script.attr("id").replace(/(\.row\S+)(-property-field-template)$/,".row"+rowNum+"$2"))})});var fieldsetId=$(fieldset).attr("id");$(fieldset).find("input[id='"+fieldsetId+".rowcount']").val(numRepeaters),_this.updateFormAttributes()}function replaceRowId(origId,rowNum){var rowIdWithSuffixRegex=/(\.row\S+)(\.\S+)$/,rowIdRegex=/\.row\S+$/;return rowIdWithSuffixRegex.test(origId)?origId.replace(rowIdWithSuffixRegex,".row"+rowNum+"$2"):origId.replace(rowIdRegex,".row"+rowNum)}function findControl(controlId){if(!controlId)return null;var $control=$("[data-bs-input-id='"+controlId+"']");return 0==$control.size()&&0==controlId.indexOf("Input.")&&($control=$("[data-bs-input-id='"+controlId.replace(/Input\./,"")+"']")),0==$control.size()&&($control=$("[input-field-id='"+controlId+"']")),0==$control.size()&&0==controlId.indexOf("Input.")&&($control=$("[input-field-id='"+controlId.replace(/Input\./,"")+"']")),$control}function initHelpText(infoBlurb){infoBlurb=infoBlurb?infoBlurb:".info-blurb",$(infoBlurb).each(function(){var helpText=$(this).data("help-text"),$container=$(this).closest(".info-icon-wrapper");$container.blurbable({blurbContainer:$container,html:_.template(_settings.infoBlurbTemplate,{helpText:helpText}),fadeTimeoutDelay:0,fadeTimeoutDuration:0})})}function initFormUpdates(){var api=new bs.Api({baseUri:"/",baseUriProxyFallback:"/",fallbackMethod:null}),appId=$("[name=clientId]").val(),packageId=getURLParameter("assetPackageId");_this.updateFormAttributes=function(target){console.log("Updating form attributes"),data=$("form").serialize(),target&&(data+="&currentControlId="+target.id),api.apiRequest("POST","apps/"+appId+"/forms/renderattributes?assetPackageId="+packageId,data,function(obj){if(obj.Response.Results.length>0){for(id in obj.Response.Results){var result=obj.Response.Results[id],$control=$("[data-bs-input-id='"+result.FormElement+"']"),attrName=null!=result.AttributeName?result.AttributeName.toLowerCase():null,attrValue=null!=result.AttributeValue?result.AttributeValue.toLowerCase():null;if($control.size()>0)if("Add"===result.UpdateType)if("disabled"===attrName){var disabled=null===attrValue||"true"===attrValue||"disabled"===attrValue;toggleFields([result.FormElement.toLowerCase()],!disabled)}else if("checked"===attrName){var checked=null===attrValue||"true"===attrValue||"checked"===attrValue;$control.find(":input").prop("checked",checked)}else $control.attr(result.AttributeName,result.AttributeValue);else"Remove"===result.UpdateType?"disabled"===attrName?toggleFields([result.FormElement.toLowerCase()],!0):"checked"===attrName?$control.find(":input").prop("checked",!1):$control.removeAttr(attrName):console.log("Unrecognized update type: "+result.UpdateType)}console.log("Done updating form attributes")}},function(obj){console.log("failed updating form attributes: api call")}),bs.onFormChange()},$(controlGroupSelector+" :input").on("change",null,function(){_this.updateFormAttributes(this)}),_this.updateFormAttributes()}var _settings={apiUrl:"",fallbackUrl:"",selectedResourceTemplate:"",validationBlurbTemplate:"",infoBlurbTemplate:"",configFormSelector:"#configuration-form",validationWarningCssClass:"alert alert-warning",validationErrorCssClass:"alert alert-danger",validationErrorIcon:"",validationWarningIcon:"",validationIconCssClass:"validation-icon",controlGroupErrorCssClass:"error",controlGroupWarningCssClass:"warning"},_blurbType={errors:"errors",warnings:"warnings"},controlGroupClass="controls",controlGroupSelector="."+controlGroupClass,validationIconWrapperClassName="validation-icon-wrapper",validationIconWrapperSelector="."+validationIconWrapperClassName,resourceMatcherSelector="bs-grouper-form-control";$.extend(!0,_settings,settings);var _hasValidated,_errors,_warnings,_$loadingIcon=$('<img src="/content/images/loading-icon-mini.gif" alt="loading..." />'),_warningsDismissed=!1,_properties={},_this=this;$(document).ready(function(){$(":text[value*='[LocalDateTime]']").each(function(){$(this).val($(this).val().replace("[LocalDateTime]",moment().format("MM/DD/YYYY h:mm:ss")))}),initFormUpdates(),initHelpText(),initTogglers(),initResourceChoosers().then(function(){initRepeatableFieldsets(),setTimeout(function(){handleAllTogglers()},1e3)}),$(_settings.configFormSelector).submit(onSubmit)})};
//# sourceMappingURL=bundles.appsessionstart.min.js.map
